# ðŸ¦„ Automatically writes unit tests for your project ðŸ¦„
This github action generates automated unit tests for your JavaScript functions with the Ponicode AI engine (this action is currently a beta version)
```yaml
- uses: ponicode/unit-testing-action@master
  with:
    repo_path: ./
    auth_token: ${{ secrets.AUTH_TOKEN }}
    write_expectations: true
```
Once the unit tests are written, use the [create pull request action](https://github.com/peter-evans/create-pull-request) to see the results in the branch of your choice
```yaml
- name: Create Pull Request
  uses: peter-evans/create-pull-request@v2
  with:
    token: ${{ secrets.GITHUB_TOKEN }}
    commit-message: '[ponicode-pull-request] Ponicode found unit tests to write!'
    branch: ponicode-tests
    title: '[Ponicode] Unit tests created'
    body: |
        Ponicode report
        - Ponicode found unit tests to write
        - Auto-generated by Ponicode
```
## Requirements
- [Ponicode](https://ponicode.com/) account
- VS Code and Ponicode extension (this requirement is temporary and will not be needed in the future)
## Terms of use
By using this action, Ponicode will send the content of all the JavaScript files of your project to the Ponicode API in order to provide you with relevant information.
# How to setup (You must follow steps 1 and 2 to make the action work)
## **Step 1**: Create a yaml workflow file in your project
Go to the root of your project, and create the path to your workflow file. For example
```
mkdir -p .github/workflows
```
Here is an example of what to put in your ```.github/workflows/ponicode.yml``` file to trigger the action.
```yaml
name: Ponicode unit test generation
on:
  push:
    branches: [ master ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    # Unit tests your functions with Ponicode action
    - uses: ponicode/unit-testing-action@master
      with:
        repo_path: ./
        auth_token: ${{ secrets.PONICODE_TOKEN }}
        write_expectations: true
      # Creates pull request with all changes in file
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: '[ponicode-pull-request] Ponicode found unit tests to write!'
        branch: ponicode-tests
        title: '[Ponicode] Unit tests created'
        body: |
            Ponicode report
            - Ponicode found unit tests to write
            - Auto-generated by Ponicode
```
**This yaml file writes your unit tests everytime you push on master and makes a pull request on a ponicode-tests branch with the test files created**

## **Step 2:** Add your Ponicode token to github secrets
To get a Ponicode token, you must first subscribe to [ponicode](https://ponicode.com/). Once you are subscribed, open vs code and follow these steps:
- Go to VScode
- Enter **ctrl + ,**
- Enter 'ponicode' in the search bar
- Copy your Ponicode token

To add the Ponicode token to your github secrets follow these steps:

- Open your project on Github
- Click on **Settings**
- Click on **Secrets**
- Click on **New Secret**
- Name: **PONICODE_TOKEN**, Value: (Paste your token from VS code)

That's it! Once this is done, the action will be triggered on every push.

# Ponicode Action inputs

| Name | Description | Required | Default |
|------|-------------|----------|---------|
| ``repo_path`` | The relative path in your repo to the files you want Ponicode to test. By default, Ponicode tests your whole repo. | true | ``./`` |
| ``auth_token`` | The Ponicode token. By default, the value is empty. The Ponicode secet is required for the action to work| true |`` `` |
| ``write_expectations`` | Decide if you want Ponicode to write the inputs + expectations (``true``) or only the inputs (``false``) | true |``true``|

# Use cases:
### Trigger Ponicode action on push on ``custom`` branch.
```yaml
name: Ponicode unit test generation when pushing on custom branch
on:
  push:
    branches: [ custom ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    # Unit tests your functions with Ponicode action
    - uses: ponicode/unit-testing-action@master
      with:
        repo_path: ./
        auth_token: ${{ secrets.PONICODE_TOKEN }}
        write_expectations: true
      # Creates pull request with all changes in file
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: '[ponicode-pull-request] Ponicode found unit tests to write!'
        branch: ponicode-tests
        title: '[Ponicode] Unit tests created'
        body: |
            Ponicode report
            - Ponicode found unit tests to write
            - Auto-generated by Ponicode
```
### Trigger Ponicode action when you push on ``master`` or when you make a pull request on ``custom`` branch
```yaml
name: Ponicode unit test generation when pushing on master or pull request on custom branch
on:
  push:
    branches: [ master ]
  pull_request: 
    branches: [ custom ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    # Unit tests your functions with Ponicode action
    - uses: ponicode/unit-testing-action@master
      with:
        repo_path: ./
        auth_token: ${{ secrets.PONICODE_TOKEN }}
        write_expectations: true
      # Creates pull request with all changes in file
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: '[ponicode-pull-request] Ponicode found unit tests to write!'
        branch: ponicode-tests
        title: '[Ponicode] Unit tests created'
        body: |
            Ponicode report
            - Ponicode found unit tests to write
            - Auto-generated by Ponicode
```
### Trigger Ponicode action when you push on ``master`` and only generate inputs for your test files
```yaml
name: Ponicode input test generation when pushing on master
on:
  push:
    branches: [ master ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    # Unit tests your functions with Ponicode action
    - uses: ponicode/unit-testing-action@master
      with:
        repo_path: ./
        auth_token: ${{ secrets.PONICODE_TOKEN }}
        write_expectations: false
      # Creates pull request with all changes in file
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: '[ponicode-pull-request] Ponicode found unit tests to write!'
        branch: ponicode-tests
        title: '[Ponicode] Unit tests created'
        body: |
            Ponicode report
            - Ponicode found unit tests to write
            - Auto-generated by Ponicode
```
If you want your action to run much quicker, you can set ``write_expectations: false`` and Ponicode will only write the input values for your test cases. You can then go to VS Code, checkout the ``ponicode-tests`` branch and write your expectations in the Ponicode interface. Once you are done, you can commit your changes!
